{% load js %}
{% load boolean %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>CSS Resources</title>
  <meta name="description" content="Crypto SpaceShip - Resources View">
  <meta name="author" content="Emiliano Alejandro Billi" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link href="https://fonts.googleapis.com/css?family=Orbitron" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Gugi" rel="stylesheet">
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
  <link rel="stylesheet" media="screen" href="/static/css/style.css">
  <script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>
  <script src="/static/js/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
</head>
<body>


<!-- particles.js container -->
<div id="particles-js">
</div>
    
    <div  class="container-fluid grid">
        <div class="row">
            <div class="col-xs-12 col-lg-12" id="header">

                <div class="row">
                    <div class="col-md-2 col-lg-2">
                        <h1 id="conquest-message" class="conquest-message">The planet has been conquered. The game could end in <span id="blocks-to-end" class="end-message"></span> Blocks. YOU ARE <span class="end-message" id="win-condition"></span></h1>
                    </div>
                    <div class="col-md-8 col-lg-8">
                        <div class="resources-general">
                    <!-- Link Start -->    
                    <!-- Links End -->
                   <!-- GUAGE COMBO ENERGY-->
                        <div class="resource-general" id="general-energy" data-toggle="tooltip" data-placement="bottom" title="Total units of energy you gathered so far">

                                <div class="resource-title">
                                    <div class="icon-ratio ic-energy"></div>
                                    <div class="title-text">energy</div>
                                    <div class="stopper"></div>
                                </div>

                                <div class="gauge">
                                    <div class="gauge-reflex"></div>
                                    <div class="gauge-bar energy" id="bar-energy" style="width: 100%;"></div>
                                    <div class="gauge-background"></div>
                                    <div class="stopper"></div>
                                </div>
                                <div class="amount">
                                        <span class="amount-current" id="energy-stock"></span> <span class="amount-total">of  <span id="warehouse-load"></span></span>
                                </div>
                                    <div class="stopper"></div>

                        </div>
                    <!-- GUAGE COMBO END -->
                    
                    <!-- GUAGE COMBO GRAPHENE -->
                        <div class="resource-general" id="general-graphene" data-toggle="tooltip" data-placement="bottom" title="Total units of energy you gathered so far">

                                <div class="resource-title">
                                    <div class="icon-ratio ic-graphene"></div>
                                    <div class="title-text">graphene</div>
                                    <div class="stopper"></div>
                                </div>

                                <div class="gauge">
                                    <div class="gauge-reflex"></div>
                                    <div class="gauge-bar graphene" id="bar-graphene" style="width: 100%;"></div>
                                    <div class="gauge-background"></div>
                                    <div class="stopper"></div>
                                </div>
                                <div class="amount">
                                        <span class="amount-current" id="graphene-stock"></span> <span class="amount-total">of  <span id="warehouse-load"></span></span>
                                </div>
                                    <div class="stopper"></div>

                        </div>
                    <!-- GUAGE COMBO END -->
                    
                    <!-- GUAGE COMBO METALS-->
                        <div class="resource-general" id="general-metals" data-toggle="tooltip" data-placement="bottom" title="Total units of metals you gathered so far">

                                <div class="resource-title">
                                    <div class="icon-ratio ic-metals"></div>
                                    <div class="title-text">metals</div>
                                    <div class="stopper"></div>
                                </div>

                                <div class="gauge">
                                    <div class="gauge-reflex"></div>
                                    <div class="gauge-bar metals" id="bar-metals" style="width: 100%;"></div>
                                    <div class="gauge-background"></div>
                                    <div class="stopper"></div>
                                </div>
                                <div class="amount">
                                        <span class="amount-current" id="metals-stock"></span> <span class="amount-total">of  <span id="warehouse-load"></span></span>
                                </div>
                                    <div class="stopper"></div>

                        </div>
                       <!-- GUAGE COMBO END -->

                       <!-- GAUGE COMBO STATUS -->
                       <div class="resource-general" id="general-metals" data-toggle="tooltip" data-placement="bottom" title="Ship Status">

                            <div class="resource-title">
                                <div class="icon-ratio ic-status"></div>
                                <div class="title-text">ship status</div>
                                <div class="stopper"></div>
                            </div>

                            <div class="gauge">
                                <div class="gauge-reflex"></div>
                                <div class="gauge-bar ship-status" id="bar-ship-status" style="width: 100%;"></div>
                                <div class="gauge-background"></div>
                                <div class="stopper"></div>
                            </div>
                            <div class="amount">
                                    <div class="repair-list" id="repair-button" style="display: none;">
                                            <div class="repair-item can-repair pointer" >
                                                <div class="icon-ratio ic-repair"></div>
                                                <div class="title-text fL repair-text">Repair</div>
                                            </div>
                                        </div>
                                    <span class="status-current"><span id="ship-status-value"></span> %</span> 
                            </div>
                                <div class="stopper"></div>

                        </div>
                        <!-- GAUGE COMBO END-->
                       
                        </div>
                    </div>
                    <div class="col-md-2 col-lg-2">
                        <div class="game-info">
                            <p>Game Age: <span id="game-age"></span></p>
                            <p>Reward: <span id="reward"></span> eth</p>
                            <p>Players:</p>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
        
        <div class="row last-row">
            <div class="col-xs-12 col-md-3-et" >
                <div class="resources-container" id="resources" style="display: none;">
                    <div class="stopper"></div>
                    <div class="gauges-container">
                  
                   <!-- <h2 class="taR">Gathering modules</h2> -->
                   
                   <!-- GUAGE COMBO ENERGY-->
                    <div class="resource-combo" id="energy">
                        <div class="combo-top">
                            <div class="resource-title">
                                <div class="icon ic-energy"></div>
                                <div class="title-text" data-toggle="tooltip" data-placement="top" title="Solar panels are devices in charge of accumulating energy as a resource for multiple porpouses. The more panels you active, the faster energy is gathered.">energy</div>
                                <div class="resource-energy-level"></div>
                                <div class="resource-name">Solar Panels x 6</div>
                                <div class="resource-upgrade" id="upgrade-energy">VIEW</div>
                                <div class="resource-upgrade upgrade-ready" id="upgrade-energy-ready">Upgrade<br>ready! <div class="icon-right ic-upgrade" ></div></div>
                                <div class="resource-upgrade upgrading" id="upgrading-energy" style="display: none;">Upgrading</div>
                                <div class="stopper"></div>
                            </div>
                        </div>
                        
                        <div class="combo-bottom" id="energy-bars">
                            <div class="gauge gauge-lateral" data-toggle="tooltip" data-placement="top" id="energy-panels-energy-tooltip" title="">
                                <div class="gauge-reflex"></div>
                                <div class="gauge-bar energy" id="bar-energy1"></div>
                                <div class="gauge-background"></div>
                            </div>
                            <div class="amount amount-lateral">
                                <span class="amount-total" id="amount-energy1"></span>
                            </div>
                            <div class="stopper"></div>
                            <div class="gauge gauge-lateral" data-toggle="tooltip" data-placement="top" id="energy-panels-graphene-tooltip" title="">
                                <div class="gauge-reflex"></div>
                                <div class="gauge-bar graphene" id="bar-graphene1"></div>
                                <div class="gauge-background" ></div>
                            </div>
                            <div class="amount amount-lateral">
                                <span class="amount-total" id="amount-graphene1"></span>
                            </div>
                            <div class="stopper"></div>
                            <div class="gauge gauge-lateral" data-toggle="tooltip" data-placement="top" id="energy-panels-metals-tooltip" title="">
                                <div class="gauge-reflex"></div>
                                <div class="gauge-bar metals" id="bar-metals1"></div>
                                <div class="gauge-background"></div>
                            </div>
                            <div class="amount amount-lateral">
                                <span class="amount-total" id="amount-metals1"></span>
                            </div>
                            <div class="stopper"></div>
                        </div>
                    </div>
                   <!-- GUAGE COMBO END -->
                   
                   <!-- GUAGE COMBO GRAPHENE-->
                    <div class="resource-combo" id="graphene">
                        <div class="combo-top">
                            <div class="resource-title">
                                <div class="icon ic-graphene"></div>
                                <div class="title-text" data-toggle="tooltip" data-placement="top" title="El Graphene Molecular Weaver permite recolectar graphene del espacio. Actualizalo para optimizar la recolección.">graphene</div>
                                <div class="resource-level"><span id="graphene-collector-level"></span></div>
                                <div class="resource-name">Molecular weaver</div>
                            <!--<div class="resource-upgrade" id="upgrade-graphene">upgrade</div> -->
                                <div class="resource-upgrade upgrade-ready" id="upgrade-graphene-ready">Upgrade<br>ready! <div class="icon-right ic-upgrade" ></div></div>
                                <div class="resource-upgrade upgrading" id="upgrading-graphene" style="display: none;">Upgrading</div>
                                <div class="stopper"></div>
                            </div>
                        </div>
                        
                        <div class="combo-bottom" id="graphene-bars">
                            <div class="gauge gauge-lateral" data-toggle="tooltip" data-placement="top" id="graphene-collector-energy-tooltip" title="">
                                <div class="gauge-reflex"></div>
                                <div class="gauge-bar energy" id="bar-energy2"></div>
                                <div class="gauge-background"></div>
                            </div>
                            <div class="amount amount-lateral">
                                <span class="amount-total" id="amount-energy2"></span>
                            </div>
                            <div class="stopper"></div>
                            <div class="gauge gauge-lateral" data-toggle="tooltip" data-placement="top" id="graphene-collector-graphene-tooltip" title="">
                                <div class="gauge-reflex"></div>
                                <div class="gauge-bar graphene" id="bar-graphene2"></div>
                                <div class="gauge-background" ></div>
                            </div>
                            <div class="amount amount-lateral">
                                <span class="amount-total" id="amount-graphene2"></span>
                            </div>
                            <div class="stopper"></div>
                            <div class="gauge gauge-lateral" data-toggle="tooltip" data-placement="top" id="graphene-collector-metals-tooltip" title="">
                                <div class="gauge-reflex"></div>
                                <div class="gauge-bar metals" id="bar-metals2"></div>
                                <div class="gauge-background"></div>
                            </div>
                            <div class="amount amount-lateral">
                                <span class="amount-total" id="amount-metals2"></span>
                            </div>
                            <div class="stopper"></div>
                        </div>
                    </div>
                   <!-- GUAGE COMBO END -->
                   
                   <!-- GUAGE COMBO METALS-->
                    <div class="resource-combo" id="metals">
                        <div class="combo-top">
                            <div class="resource-title">
                                <div class="icon ic-metals"></div>
                                <div class="title-text" data-toggle="tooltip" data-placement="top" title="Recolecta metales utilizando el Metals Harvesting Module. Su nivel determinará tu producción de metales.">metals</div>
                                <div class="resource-level"><span id="metals-collector-level"></span></div>
                                <div class="resource-name">Harvesting Module</div>
                            <!--<div class="resource-upgrade" id="upgrade-metals">upgrade</div> -->
                                <div class="resource-upgrade upgrade-ready" id="upgrade-metals-ready">Upgrade<br>ready! <div class="icon-right ic-upgrade"></div></div>
                                <div class="resource-upgrade upgrading" id="upgrading-metals" style="display: none;">Upgrading</div>
                                <div class="stopper"></div>
                            </div>
                        </div>
                        
                        <div class="combo-bottom" id="metals-bar">
                            <div class="gauge gauge-lateral" data-toggle="tooltip" data-placement="top" id="metals-collector-energy-tooltip" title="">
                                <div class="gauge-reflex"></div>
                                <div class="gauge-bar energy" id="bar-energy3"></div>
                                <div class="gauge-background"></div>
                            </div>
                            <div class="amount amount-lateral">
                                <span class="amount-total" id="amount-energy3"></span>
                            </div>
                            <div class="stopper"></div>
                            <div class="gauge gauge-lateral" data-toggle="tooltip" data-placement="top" id="metals-collector-graphene-tooltip" title="">
                                <div class="gauge-reflex"></div>
                                <div class="gauge-bar graphene" id="bar-graphene3"></div>
                                <div class="gauge-background" ></div>
                            </div>
                            <div class="amount amount-lateral">
                                <span class="amount-total" id="amount-graphene3"></span>
                            </div>
                            <div class="stopper"></div>
                            <div class="gauge gauge-lateral" data-toggle="tooltip" data-placement="top" id="metals-collector-metals-tooltip" title="">
                                <div class="gauge-reflex"></div>
                                <div class="gauge-bar metals" id="bar-metals3"></div>
                                <div class="gauge-background"></div>
                            </div>
                            <div class="amount amount-lateral">
                                <span class="amount-total" id="amount-metals3"></span>
                            </div>
                            <div class="stopper"></div>
                        </div>
                    </div>
                   <!-- GUAGE COMBO END -->
                   
                </div> 
                </div>
            </div>
            
            
            <!-- CENTER COLUMN -->
            <div class="col-xs-12 col-md-6-et">
                <div class="shipContainer">
                    <div class="ship-img">
                        <img src="/static/images/hull.png">
                    </div>
                    <div class="ship-title"><span id="ship-name"></span></div>
                </div>
                
                <!-- Nav-bar arriba
                <div class="nav-bar">
                        <div class="views-container">
                           <div class="view">
                                <a href="#">Home</a>
                            </div>
                            <div class="view selected">
                                <a href="#">Resources</a>
                            </div>
                            <div class="view">
                                <a href="map.html">Map</a>
                            </div>
                            <div class="view">
                                <a href="#">Buildings</a>
                            </div>
                            <div class="view">
                                <a href="#">Messages</a>
                            </div>
                            <div class="view">
                                <a href="#">Events</a>
                            </div>
                        </div>
                    </div> -->
            </div>
            <!-- CENTER COLUMN END -->
            
            
            <div class="col-xs-12 col-md-3-et">
               <div class="stats-container" id="stats" style="display: none;">
               
                <!-- <h2 class="taL">Stats</h2> -->
                
                    <!-- COMBO LOCATION -->
                    <div class="resource-combo" id="location">
                        <div class="combo-top">
                            <div class="resource-title">
                                <div class="icon ic-location"></div>
                                <div class="title-text">location</div>
                                <div class="location-coords">( <span id="position-x"></span>, <span id="position-y"></span> )</div>
                                <div class="resource-name">Map coordinates</div>
                                <div class="stopper"></div>
                            </div>
                        </div>
                        
                    </div>
                   <!-- COMBO LOCATION END -->
                   
                   <!-- COMBO PRODUCTION RATIO -->
                    <div class="resource-combo" id="production-ratio">
                        <div class="combo-top">
                            <div class="resource-title">
                                <div class="icon ic-production"></div>
                                <div class="title-text">production ratio</div>
                                <div class="resource-name">Units per block</div>
                                <div class="stopper"></div>
                            </div>
                        </div>
                        <div class="combo-bottom">
                            <!-- RATIO LIST ITEM -->
                            <div class="ratio-list">
                                <div class="ratio-item">
                                    <div class="icon-ratio ic-energy"></div>
                                    <div class="title-text fL">Energy</div>
                                    <div class="ratio-amount fR"><span id="energy-production"></span>x</div>
                                    <div class="stopper"></div>
                                </div>
                            </div>
                            
                            <!-- RATIO LIST ITEM -->
                            <div class="ratio-list">
                                <div class="ratio-item">
                                    <div class="icon-ratio ic-graphene"></div>
                                    <div class="title-text fL">Graphene</div>
                                    <div class="ratio-amount fR"><span id="graphene-production"></span>x</div>
                                    <div class="stopper"></div>
                                </div>
                            </div>
                            
                            <!-- RATIO LIST ITEM -->
                            <div class="ratio-list">
                                <div class="ratio-item">
                                    <div class="icon-ratio ic-metals"></div>
                                    <div class="title-text fL">Metals</div>
                                    <div class="ratio-amount fR"><span id="metals-production"></span>x</div>
                                    <div class="stopper"></div>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                   <!-- COMBO PRODUCTION RATIO END -->
                
                    <!-- COMBO PRODUCTION TIME -->
                        <div class="resource-combo" id="production-time">
                            <div class="combo-top">
                                <div class="resource-title">
                                    <div class="icon ic-time"></div>
                                    <div class="title-text">Resources Upgrade</div>
                                    <div class="resource-name">Countdown Blocks to end </div>
                                    <div class="stopper"></div>
                                </div>
                            </div>
                            
                            <div class="combo-bottom">
                                <div class="watch-container-unique">
                                    <div class="block-amount">
                                        <span id="countdown-upgrade-blocks"></span>
                                    </div>
                                    <div class="block-amount-title">
                                        Blocks
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                   <!-- COMBO PRODUCTION TIME END -->
                
               </div> 
            </div>
        </div> 
              
               
    </div>

<!-- Modal for pannels -->
<div class="modal fade" id="modal-energy-upgrade" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalCenterTitle">UPGRADE AVAILABLE</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" id="modal-body">
            <div class="modal-body-text">Solar Panels</div>
            <div class="panel-container">
                    <div class="solarPanel">PANEL 1 in <span class="energy-panel-color">LEVEL <span id="pe1-level"></span></span></div>
                    <div class="ratio-item-modal blink" panel-number="1" id="pe1-upgrade-ready">
                            <div class="icon-ratio ic-upgrade"></div>
                            <div class="title-text fL">UPGRADE READY to Level <span id="pe1-nextLevel"></span></div>
                            <div class="stopper"></div>
                    </div>
            </div>

            <div class="panel-container">
                    <div class="solarPanel">PANEL 2 in <span class="energy-panel-color">LEVEL <span id="pe2-level"></span></span></div>
                    <div class="ratio-item-modal blink" panel-number="2" id="pe2-upgrade-ready">
                            <div class="icon-ratio ic-upgrade"></div>
                            <div class="title-text fL">UPGRADE READY to Level <span id="pe2-nextLevel"></span></div>
                            <div class="stopper"></div>
                    </div>
            </div>

            <div class="panel-container">
                    <div class="solarPanel">PANEL 3 in <span class="energy-panel-color">LEVEL <span id="pe3-level"></span></span></div>
                    <div class="ratio-item-modal blink" panel-number="3" id="pe3-upgrade-ready">
                            <div class="icon-ratio ic-upgrade"></div>
                            <div class="title-text fL">UPGRADE READY to Level <span id="pe3-nextLevel"></span></div>
                            <div class="stopper"></div>
                    </div>
            </div>

            <div class="panel-container">
                    <div class="solarPanel">PANEL 4 in <span class="energy-panel-color">LEVEL <span id="pe4-level"></span></span></div>
                    <div class="ratio-item-modal blink" panel-number="4" id="pe4-upgrade-ready">
                            <div class="icon-ratio ic-upgrade"></div>
                            <div class="title-text fL">UPGRADE READY to Level <span id="pe4-nextLevel"></span></div>
                            <div class="stopper"></div>
                    </div>
            </div>

            <div class="panel-container">
                    <div class="solarPanel">PANEL 5 in <span class="energy-panel-color">LEVEL <span id="pe5-level"></span></span></div>
                    <div class="ratio-item-modal blink" panel-number="5" id="pe5-upgrade-ready">
                            <div class="icon-ratio ic-upgrade"></div>
                            <div class="title-text fL">UPGRADE READY to Level <span id="pe5-nextLevel"></span></div>
                            <div class="stopper"></div>
                    </div>
            </div>

            <div class="panel-container">
                    <div class="solarPanel">PANEL 6 in <span class="energy-panel-color">LEVEL <span id="pe6-level"></span></span></div>
                    <div class="ratio-item-modal blink" panel-number="6" id="pe6-upgrade-ready">
                            <div class="icon-ratio ic-upgrade"></div>
                            <div class="title-text fL">UPGRADE READY to Level <span id="pe6-nextLevel"></span></div>
                            <div class="stopper"></div>
                    </div>
            </div>            
            
      </div>
      <div class="modal-footer">
        <div class="solar-panel-cost">
            <div class="title-text fL">Cost for Panel: <span id="solar-panel-cost-index"></span> </div>
            <div class="ratio-item-modal">
                <div class="icon-ratio ic-energy"></div>
                <div class="title-text fL"><span id="energy-energy-upgrade"></span></div>
                    
                <div class="stopper"></div>
            </div> 
            <div class="ratio-item-modal">
                <div class="icon-ratio ic-graphene"></div>
                <div class="title-text fL"><span id="graphene-energy-upgrade"></span></div>
                <div class="stopper"></div>
            </div>
            <div class="ratio-item-modal">
                <div class="icon-ratio ic-metals"></div>
                <div class="title-text fL"><span id="metals-energy-upgrade"></span></div>
                <div class="stopper"></div>
            </div>  
        </div>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" id="button-upgrade-energy-panel" class="btn btn-primary">Confirm</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal for pannels Graphene -->
<div class="modal fade" id="modal-graphene-upgrade" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalCenterTitle">UPGRADE AVAILABLE</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" id="modal-body">
        <div class="modal-body-text">UPGRADE Molecular Weaver to LEVEL <span id="next-graphene-level"></span></div>
      </div>
      <div class="modal-footer">
            <div class="title-text fL">Resources Cost:</div>
            <div class="ratio-item-modal">
                <div class="icon-ratio ic-energy"></div>
                <div class="title-text fL"><span id="energy-graphene-upgrade"></span></div>
                    
                <div class="stopper"></div>
            </div> 
            <div class="ratio-item-modal">
                <div class="icon-ratio ic-graphene"></div>
                <div class="title-text fL"><span id="graphene-graphene-upgrade"></span></div>
                <div class="stopper"></div>
            </div>
            <div class="ratio-item-modal">
                <div class="icon-ratio ic-metals"></div>
                <div class="title-text fL"><span id="metals-graphene-upgrade"></span></div>
                <div class="stopper"></div>
            </div>  
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" id="button-upgrade-graphene" class="btn btn-primary">Confirm</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal for pannels Metal -->
<div class="modal fade" id="modal-metal-upgrade" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalCenterTitle">UPGRADE AVAILABLE</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" id="modal-body">
        <div class="modal-body-text">UPGRADE Metal Harvester to LEVEL <span id="next-metals-level"></span></div>
      </div>
      <div class="modal-footer">
            <div class="title-text fL">Resources Cost:</div>
            <div class="ratio-item-modal">
                <div class="icon-ratio ic-energy"></div>
                <div class="title-text fL"><span id="energy-metals-upgrade"></span></div>
                    
                <div class="stopper"></div>
            </div> 
            <div class="ratio-item-modal">
                <div class="icon-ratio ic-graphene"></div>
                <div class="title-text fL"><span id="graphene-metals-upgrade"></span></div>
                <div class="stopper"></div>
            </div>
            <div class="ratio-item-modal">
                <div class="icon-ratio ic-metals"></div>
                <div class="title-text fL"><span id="metals-metals-upgrade"></span></div>
                <div class="stopper"></div>
            </div>  
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" id="button-upgrade-metals" class="btn btn-primary">Confirm</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="modal-tx" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalCenterTitle">Order Submited</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                    </div>
                    <div class="modal-body" id="modal-body">
                            <div class="modal-body-text">ORDER: <span id="change mode"></span></div>
                            <div class="modal-body-text">Click <a id="link_to_etherscan" href="">here</a> to verify the transaction status in Etherscan</span></div>
                        </div>
                        <div class="modal-footer">
                        
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div> 

            <div class="modal fade" id="modal_upgrading" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalCenterTitle">Upgrade in Progress</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                        </div>
                        <div class="modal-body" id="modal-body">
                                <div class="modal-body-text">You are currently upgrading <span id="resource-upgrading"></span></div>
                            </div>
                            <div class="modal-footer">
                            
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div> 
</body>
<!-- scripts -->
<script src="/static/js/particles.min.js"></script>
<script src="/static/js/app.js"></script>
<script src="/static/js/cssgame.js"></script>
<script src="/static/js/backend.js"></script>
<script>

    window.DEBUG = true;
    window.planetOwner = {{ game_candidate }};
    window.reward = {{ game_reward }};
    window.gameAge = {{ last_block_number }} - {{ game_launch }};
    window.blocksToEnd = {{ game_end_block }} - {{ last_block_number }};

    window.gameAbi = {{ game_abi | js}};
    window.gameAddress = "{{ game_address }}";
    window.gameNetwork = {{ game_network }};

    window.ship = {{ ship_id }};
    window.damage = {{ damage }};
    window.in_port = {{ in_port | boolean }};

    window.grapheneCollectorLevel = {{ graphene_collector_level }};
    window.metalsCollectorLevel = {{ metals_collector_level }};
    window.energyPanels = {{ energy_level }};
    
    window.eventsCount = {{ events_count }};
    
    window.warehouseLevel = {{ warehouse_level }};
    window.warehouseLoad = CSSGame.getWarehouseLoadByLevel(window.warehouseLevel)
    
    window.position_x = {{ position_x }};
    window.position_y = {{ position_y }};
    window.shipName = "{{ ship_name }}";

    window.energyProduction = {{ energy_production }};
    window.grapheneProduction = {{ graphene_production }};
    window.metalsProduction = {{ metals_production}};

    // Update con setTimer()
    window.resourceBlock = {{ countdown_resources }};
    window.grapheneStock = {{ graphene_stock }};
    window.energyStock =  {{ energy_stock }};
    window.metalsStock = {{ metal_stock }};

    window.resourceUpgrading = {{ resource_upgrading }};

    // URL
    window.base_url = "{{ base_url }}";
    window.etherscan_url = "https://kovan.etherscan.io/tx/";
    window.game = {{ game_id }};

</script>

<script>
 $(document).ready(function() {

    if (typeof web3 !== 'undefined' && web3.currentProvider.isMetaMask == true ) {
        web3.version.getNetwork(function(error,network) {
            if (!error && network == window.gameNetwork) {
                w3 = new Web3(web3.currentProvider);
                window.cssgame = new CSSGame(w3,window.gameAbi,window.gameAddress,web3);
                window.backend = new Backend(window.base_url);


                function clean_modal() {
                    window.id_modal_open = undefined;
                }

                function process_order (order, tx) {
                    /*
                     * Se cierra el modal
                     */
                    $(window.id_modal_open).modal('hide');
                    window.backend.orders.add(window.game,window.ship,order,tx,function(e,r) {
                        if (!e) {
                            setInterval(function(){
                                w3.eth.getTransactionReceipt(tx, function(e,h){
                                    if (h) location.reload();
                                });
                            },3000);
                        } else {
                            console.log(e);
                        }
                    });
                    $('#link_to_etherscan').attr('href', window.etherscan_url + tx);
                    $('#modal-tx').modal('show');
                }


                for ( i = 1; i <= 12; i++ ) {
                    panel = '#pe' + i.toString() + '-upgrade-ready';
                    $(panel).click(function() {
                        id = '#' + $(this).attr('id');
                        upgradePanel($(id).attr('panel-number'));
                    });
                }

                function upgradePanel(n) {
                    i = parseInt(n);
                    nextLevel = window.energyPanels[i-1]+1;

                    eRes = CSSGame.getResourceUpgradeCost(0,nextLevel);
                    // Render HTML
                    $('#energy-energy-upgrade').text(eRes.energy);
                    $('#graphene-energy-upgrade').text(eRes.graphene);
                    $('#metals-energy-upgrade').text(eRes.metals);
                    
                    // Display Cost
                    $('#button-upgrade-energy-panel').removeClass('disabled');
                    $('#button-upgrade-energy-panel').off();
                    $('#solar-panel-cost-index').text(i);
                    $('#button-upgrade-energy-panel').click(function() {
                        window.cssgame.upgradeEnergy(window.ship,i-1,function(e,h){
                            if (!e) 
                                process_order("upgrade_energy",h);
                        });
                    });
                    $('.solar-panel-cost').css('display','flex');
                }


                

                // Handlers
                function energyModalHandler() {
                    $('#button-upgrade-energy-panel').addClass('disabled');
                    for (i = 1; i <= 12; i++ ) {
                        id_prefix = '#pe' + i.toString();
                        idPanelLevel = id_prefix + '-level';
                        idDivUpgrade = id_prefix + '-upgrade-ready';
                        idNextLevel  = id_prefix + '-nextLevel';
                        $(idPanelLevel).text(window.energyPanels[i-1]);

                        eRes = CSSGame.getResourceUpgradeCost(0,window.energyPanels[i-1]+1);
                        if (eRes.energy <= window.energyStock && 
                            eRes.graphene <= window.grapheneStock && 
                            eRes.metals <= window.metalsStock && 
                            window.resourceBlock == 0) 
                        {
                            $(idDivUpgrade).show();
                            $(idNextLevel).text(window.energyPanels[i-1]+1);
                        }
                        else {
                            $(idDivUpgrade).hide();
                        }
                    }
                    // Finaly Show the Modal
                    window.id_modal_open = '#modal-energy-upgrade';
                    $('#modal-energy-upgrade').modal('show');
                }

                $('#upgrade-energy').click(function() {
                    energyModalHandler();
                });

                $('#button-upgrade-graphene').click(function() {
                    window.cssgame.upgradeGraphene(window.ship,function(e,h){
                        if (!e) 
                            process_order("upgrade_graphene",h);
                    });
                });

                $('#button-upgrade-metals').click(function() {
                    window.cssgame.upgradeMetals(window.ship,function(e,h){
                        if (!e) 
                            process_order("upgrade_metals",h);
                    });
                });

                $('#upgrade-energy-ready').click(function() {
                    energyModalHandler();
                });

                $('#modal-energy-upgrade').on('hidden.bs.modal', function () {
                    clean_modal();
                    $('.solar-panel-cost').css('display','none');
                    $('#button-upgrade-energy-panel').off();
                    $('#button-upgrade-energy-panel').addClass('disabled');
                });

                $('#upgrade-graphene-ready').click(function() {
                    // Get Values
                    nextLevel = window.grapheneCollectorLevel+1;
                    gRes = CSSGame.getResourceUpgradeCost(1,nextLevel);
                    // Render HTML
                    $('#next-graphene-level').text(nextLevel);
                    $('#energy-graphene-upgrade').text(gRes.energy);
                    $('#graphene-graphene-upgrade').text(gRes.graphene);
                    $('#metals-graphene-upgrade').text(gRes.metals);
                    
                    // Finally Show the Modal
                    window.id_modal_open = '#modal-graphene-upgrade';
                    $('#modal-graphene-upgrade').modal('show');
                });

                $('#modal-graphene-upgrade').on('hidden.bs.modal', function () {
                    clean_modal();
                });

                $('#upgrading-energy').click(function() {
                    modal_upgrading();
                });
                
                $('#upgrading-graphene').click(function () {
                    modal_upgrading();
                });

                $('#upgrading-metals').click(function() {
                    modal_upgrading();
                });
                 
                
                function modal_upgrading () {
                    if (window.resourceUpgrading > 0 && window.resourceUpgrading <= 6)
                        text = 'Energy Panel ' + window.resourceUpgrading.toString() + ' at level ' + (window.energyPanels[window.resourceUpgrading-1] + 1).toString();

                    if (window.resourceUpgrading == 7)
                        text = 'Graphene Molecular Weaver at level ' + (window.grapheneCollectorLevel+1).toString();

                    if (window.resourceUpgrading == 8)
                        text = 'Metal Harvesting Module at level ' + (window.metalsCollectorLevel+1).toString();

                    $('#resource-upgrading').text(text);
                    $('#modal_upgrading').modal('show');
                }

                $('#modal_upgrading').on('hidden.bs.modal', function() {
                    $('#resource-upgrading').text('');
                });

                $('#upgrade-metals-ready').click(function() {
                    // Get Values
                    nextLevel = window.metalsCollectorLevel+1;
                    mRes = CSSGame.getResourceUpgradeCost(2,nextLevel);
                    // Render HTML
                    $('#next-metals-level').text(nextLevel);
                    $('#energy-metals-upgrade').text(mRes.energy);
                    $('#graphene-metals-upgrade').text(mRes.graphene);
                    $('#metals-metals-upgrade').text(mRes.metals);
                    
                    // Finally Show the Modal
                    window.id_modal_open = '#modal-metal-upgrade';
                    $('#modal-metal-upgrade').modal('show');
                });

                $('#modal-metal-upgrade').on('hidden.bs.modal', function () {
                    clean_modal();
                });

                function checkResourceUpgrade() {

                    e = Math.min(...window.energyPanels);
                    window.energyMinLevel = e;
                    if (e<10)
                        setUpgradeResourceBar(0, e+1);

                    if (window.grapheneCollectorLevel < 10) {
                        if (window.resourceUpgrading == 7 && window.resourceBlock != 0)
                            setUpgradeResourceBar(1, window.grapheneCollectorLevel+2);
                        else
                            setUpgradeResourceBar(1, window.grapheneCollectorLevel+1);
                    }

                    if (window.metalsCollectorLevel < 10) {
                        if (window.resourceUpgrading == 8 && window.resourceBlock != 0) 
                            setUpgradeResourceBar(2, window.metalsCollectorLevel+2);
                        else
                            setUpgradeResourceBar(2, window.metalsCollectorLevel+1);
                    }
                    if (window.resourceUpgrading > 0 && window.resourceUpgrading <= 9 && window.resourceBlock != 0) {
                        if (window.resourceUpgrading <= 6) {
                            setUpgradeResourceReady(0,2);
                            setUpgradeResourceReady(1,1);
                            setUpgradeResourceReady(2,1);
                        } else {
                            if (window.resourceUpgrading == 7) {
                                setUpgradeResourceReady(1,2);
                                setUpgradeResourceReady(0,1);
                                setUpgradeResourceReady(2,1);
                            } else {
                                setUpgradeResourceReady(0,1);
                                setUpgradeResourceReady(1,1);
                                setUpgradeResourceReady(2,2);
                            }
                        }
                    } else {
                        
                        // Resource 0 is Energy
                        if (e<10) {
                            eRes = CSSGame.getResourceUpgradeCost(0,e+1);
                            if ( eRes.energy <= window.energyStock && 
                                eRes.graphene <= window.grapheneStock && 
                                eRes.metals <= window.metalsStock && 
                                window.resourceBlock == 0)
                                setUpgradeResourceReady(0,0);
                            else
                                setUpgradeResourceReady(0,1);
                        }
                        else {
                            setUpgradeResourceReady(0,1);
                            //setUpgradeReady(0,false);
                            //$('#energy-bars').hide();
                        }

                        // Resource 1 is Graphene
                        if (window.grapheneCollectorLevel < 10) {

                            gRes = CSSGame.getResourceUpgradeCost(1,window.grapheneCollectorLevel+1);
                            if ( gRes.energy <= window.energyStock && 
                                gRes.graphene <= window.grapheneStock && 
                                gRes.metals <= window.metalsStock && 
                                window.resourceBlock == 0)
                                setUpgradeResourceReady(1,0);
                                //setUpgradeReady(1,true);
                            else
                                setUpgradeResourceReady(1,1);
                                //setUpgradeReady(1,false);
                        } else {
                            setUpgradeResourceReady(1,1);
                            //setUpgradeReady(1,false);
                            //$('#graphene-bars').hide();
                        }

                        // Resource 2 is Metals
                        if (window.metalsCollectorLevel < 10) {
                            mRes = CSSGame.getResourceUpgradeCost(2,window.metalsCollectorLevel+1);
                            if ( mRes.energy <= window.energyStock && 
                                mRes.graphene <= window.grapheneStock && 
                                mRes.metals <= window.metalsStock && 
                                window.resourceBlock == 0)
                                setUpgradeResourceReady(2,0);
                                //setUpgradeReady(2,true);
                            else
                                setUpgradeResourceReady(2,1);
                                //setUpgradeReady(2,false);
                        } else {
                            setUpgradeResourceReady(2,1);
                            //setUpgradeReady(2,false);
                            //$('#metals-bar').hide();
                        }
                    }
                }    

                function setUpgradeResourceBar(resource,level) {

                    res = CSSGame.getResourceUpgradeCost(resource,level);        
                    energy = Math.floor(window.energyStock * 100 / res.energy);
                    graphene = Math.floor(window.grapheneStock * 100 / res.graphene);
                    metals = Math.floor(window.metalsStock * 100 / res.metals);

                    if (energy > 100) energy = 100;
                    if (graphene > 100) graphene = 100;
                    if (metals > 100) metals = 100;

                    switch (resource) {
                        case 0:
                            bar_energy = '#bar-energy1';
                            amount_energy = '#amount-energy1';
                            bar_graphene = '#bar-graphene1';
                            amount_graphene = '#amount-graphene1';
                            bar_metals = '#bar-metals1';
                            amount_metals = '#amount-metals1';
                            break;
                        case 1:
                            bar_energy = '#bar-energy2';
                            amount_energy = '#amount-energy2';
                            bar_graphene = '#bar-graphene2';
                            amount_graphene = '#amount-graphene2';
                            bar_metals = '#bar-metals2';
                            amount_metals = '#amount-metals2';
                            break;
                        case 2:
                            bar_energy = '#bar-energy3';
                            amount_energy = '#amount-energy3';
                            bar_graphene = '#bar-graphene3';
                            amount_graphene = '#amount-graphene3';
                            bar_metals = '#bar-metals3';
                            amount_metals = '#amount-metals3';
                            break;
                    }
                    if (level < 11) {
                        $(amount_energy).text(energy.toString()+'%');
                        $(amount_graphene).text(graphene.toString()+'%');
                        $(amount_metals).text(metals.toString()+'%');
                    }
                    else {
                        $(amount_energy).text('');
                        $(amount_graphene).text('');
                        $(amount_metals).text('');
                    }
                    $(bar_energy).attr("style", "width:" + energy.toString() + '%');
                    $(bar_graphene).attr("style", "width:" + graphene.toString() + '%');
                    $(bar_metals).attr("style", "width:" + metals.toString() + '%');
                }

                function setResourcesStock() {

                    try { 
                        if (typeof window.energyStock !== 'undefined') 
                            $('#energy-stock').text(window.energyStock.toString());
                        else 
                            throw "window.energyStock undefined";

                        if (typeof window.grapheneStock !== 'undefined')
                            $('#graphene-stock').text(window.grapheneStock.toString());
                        else
                            throw "window.grapheneStock undefined";

                        if (typeof window.metalsStock !== 'undefined')
                            $('#metals-stock').text(window.metalsStock.toString());
                        else
                            throw "window.metalsStock undefined";
                    }
                    catch(err) {
                        if (window.DEBUG == true) {
                            window.alert(err)
                        }
                        else {
                            console.log(err);
                        }
                    }
                }

                function setProduction() {
                    $('#energy-production').text(window.energyProduction);
                    $('#graphene-production').text(window.grapheneProduction);
                    $('#metals-production').text(window.metalsProduction);
                    $('#metals-collector-level').text(window.metalsCollectorLevel);
                    $('#graphene-collector-level').text(window.grapheneCollectorLevel);
                }

                function setCountdown() {
                    $('#countdown-upgrade-blocks').text(window.resourceBlock);
                }
                
                function setEventsCounter() {
                    if (window.eventsCount > 0) {
                        $('#events-alert').text(window.eventsCount);
                    }
                    else {
                        $('#events-alert').text('');
                    }
                }

                function setShip() {
                    $('#ship-name').text(window.shipName);
                    $('#position-x').text(window.position_x);
                    $('#position-y').text(window.position_y);
                }

                function setUpgradeResourceReady(resource, show_type) {
                    switch(resource) {
                        case 0:
                            id_view = "#upgrade-energy";
                            id_ready = "#upgrade-energy-ready";
                            id_upgrading = "#upgrading-energy";
                            if (show_type == 0) {
                                // Upgrade Ready
                                $(id_view).hide();
                                $(id_ready).show();
                                $(id_upgrading).hide();
                                return;
                            }
                            if (show_type == 1) {
                                // No upgrade
                                $(id_view).show();
                                $(id_ready).hide();
                                $(id_upgrading).hide();
                                return;
                            }
                            if (show_type == 2) {
                                // Upgrading
                                $(id_view).hide();
                                $(id_ready).hide();
                                $(id_upgrading).show();
                                return;
                            }
                            break;
                        case 1:
                            id_ready = "#upgrade-graphene-ready";
                            id_upgrading = "#upgrading-graphene";
                            if (show_type == 0) {
                                // Upgrade Ready    
                                $(id_ready).show();
                                $(id_upgrading).hide();
                                return;
                            }
                            if (show_type == 1) {
                                // No upgrade
                                $(id_ready).hide();
                                $(id_upgrading).hide();
                                return;
                            }
                            if (show_type == 2) {
                                // Upgrading
                                $(id_ready).hide();
                                $(id_upgrading).show();
                                return;
                            }
                            break;
                        case 2:
                            id_ready = "#upgrade-metals-ready";
                            id_upgrading = "#upgrading-metals";
                            if (show_type == 0) {
                                // Upgrade Ready    
                                $(id_ready).show();
                                $(id_upgrading).hide();
                                return;
                            }
                            if (show_type == 1) {
                                // No upgrade
                                $(id_ready).hide();
                                $(id_upgrading).hide();
                                return;
                            }
                            if (show_type == 2) {
                                // Upgrading
                                $(id_ready).hide();
                                $(id_upgrading).show();
                                return;
                            }
                            break;
                    }
                }


                function setUpgradeReady(resource, show) {
                    try {
                        if (typeof resource !== 'undefined' && typeof show !== 'undefined') {
                            if (resource == 0 || resource === 'energy') {
                                id = '#upgrade-energy-ready';
                                if (show)
                                    $('#upgrade-energy').hide();
                                else
                                    $('#upgrade-energy').show();
                            }
                            else { 
                                if (resource == 1 || resource === 'graphene')
                                    id = '#upgrade-graphene-ready';
                                else {
                                    if (resource == 2 || resource === 'metals') {
                                        id = '#upgrade-metals-ready';
                                    }
                                }
                            }
                            if (show == true )
                                $(id).show();
                            else
                                $(id).hide();
                        }
                        else {
                            throw "Invalid Parameter";
                        }
                    }
                    catch(err) {
                        if (window.DEBUG == true) {
                            window.alert(err);
                        }
                        else {
                            console.log(err);
                        }
                    }
                }

                function getUpgradeResourcesCost()
                {

                    let energyCost = CSSGame.getResourceUpgradeCost(0, window.energyMinLevel+1);
                    let grapheneCost;
                    let metalsCost;
                    if (window.resourceUpgrading == 7 && window.resourceBlock != 0)
                        grapheneCost = CSSGame.getResourceUpgradeCost(1, window.grapheneCollectorLevel+2);
                    else
                        grapheneCost = CSSGame.getResourceUpgradeCost(1, window.grapheneCollectorLevel+1);
                    
                    if (window.resourceUpgrading == 8 && window.resourceBlock != 0)
                        metalsCost = CSSGame.getResourceUpgradeCost(2, window.metalsCollectorLevel+2);  
                    else
                        metalsCost = CSSGame.getResourceUpgradeCost(2, window.metalsCollectorLevel+1);
                    
                    if (window.energyMinLevel < 10) {
                        $('#energy-panels-energy-tooltip').attr('data-original-title', 'Energy required for next level: ' + parseInt(energyCost.energy).toString());
                        $('#energy-panels-graphene-tooltip').attr('data-original-title', 'Graphene required for next level: ' + parseInt(energyCost.graphene).toString());
                        $('#energy-panels-metals-tooltip').attr('data-original-title', 'Metals required for next level: ' + parseInt(energyCost.metals).toString());
                    }
                    else {
                        $('#energy-panels-energy-tooltip').attr('data-original-title', 'Energy panels max level reached');
                        $('#energy-panels-graphene-tooltip').attr('data-original-title', 'Energy panel max level reached');
                        $('#energy-panels-metals-tooltip').attr('data-original-title', 'Energy panel max level reached');
                    }
                    
                    if (window.grapheneCollectorLevel < 10) {
                        $('#graphene-collector-energy-tooltip').attr('data-original-title', 'Energy required for next level: ' + parseInt(grapheneCost.energy).toString());
                        $('#graphene-collector-graphene-tooltip').attr('data-original-title', 'Graphene required for next level: ' + parseInt(grapheneCost.graphene).toString());
                        $('#graphene-collector-metals-tooltip').attr('data-original-title', 'Metals required for next level: ' + parseInt(grapheneCost.metals).toString());
                    }
                    else {
                        $('#graphene-collector-energy-tooltip').attr('data-original-title', 'Graphene collector max level reached');
                        $('#graphene-collector-graphene-tooltip').attr('data-original-title', 'Graphene collector max level reached');
                        $('#graphene-collector-metals-tooltip').attr('data-original-title', 'Graphene collector max level reached');
                    }
                    
                    if (window.metalsCollectorLevel < 10) {
                        $('#metals-collector-energy-tooltip').attr('data-original-title', 'Energy required for next level: ' + parseInt(metalsCost.energy).toString());
                        $('#metals-collector-graphene-tooltip').attr('data-original-title', 'Graphene required for next level: ' + parseInt(metalsCost.graphene).toString());
                        $('#metals-collector-metals-tooltip').attr('data-original-title', 'Metals required for next level: ' + parseInt(metalsCost.metals).toString());
                    }
                    else {
                        $('#metals-collector-energy-tooltip').attr('data-original-title', 'Metals collector max level reached');
                        $('#metals-collector-graphene-tooltip').attr('data-original-title', 'Metals collector max level reached');
                        $('#metals-collector-metals-tooltip').attr('data-original-title', 'Metals collector max level reached');
                    }
                }
                
                function setDamage() {
                    let status = 100 - window.damage;
                    let statusPercentage = status.toString() + '%'
                    $('#bar-ship-status').css('width', statusPercentage);
                    if (status <= 25) {
                        $('#bar-ship-status').css('background-color', '#eb1e0fbd');
                        $('#ship-status-value').css('animation','blinker 1s linear infinite');
                    } else {
                        if (status < 80) {
                            $('#bar-ship-status').css('background-color', '#d9eb0fbd');
                        }
                    }
                    $('#ship-status-value').text(status);

                    if (window.damage != 0 && window.in_port) {
                        $('#repair-button').show();
                    } 
                }

                // Once Time
                setProduction();
                setShip();
                setDamage();
                setGameStats();
                setEventsCounter();

                setResourcesStock();
                checkResourceUpgrade();
                setCountdown();
                getUpgradeResourcesCost();

                function setGameStats() {
                        let noOwner = "0x0000000000000000000000000000000000000000";
                        if (window.planetOwner != noOwner) {
                            if (window.blocksToEnd < 0)
                                window.blocksToEnd = 0;
                            $('#blocks-to-end').text(window.blocksToEnd);
                            if (window.cssgame.w3.eth.accounts[0] != window.planetOwner)
                                $('#win-condition').text("LOSING");
                            else
                                $('#win-condition').text("WINNING");
                            $('#conquest-message').show();
                        }
                        $('#reward').text(window.reward/1000000000000000000);
                        $('#game-age').text(window.gameAge);
                    }

                    setInterval(()=>{
                        window.cssgame.getGame2((e,r)=>{
                            if (!e) {
                                window.cssgame.w3.eth.getBlockNumber((e,b)=>{
                                    if (!e) {
                                        ret = window.cssgame.getGame2Result(r);
                                        window.gameAge = b - ret.gameLaunch;
                                        if (b > ret.endBlock) 
                                            window.blocksToEnd = 0;
                                        else
                                            window.blocksToEnd = ret.endBlock - b;
                                        window.planetOwner = ret.candidate;
                                        window.reward = ret.reward;
                                        setGameStats();
                                    }
                                });
                            } else {
                                console.log(e);
                            }
                        });
                    },5000);

                setInterval(function() {
                    window.cssgame.viewShipVars(window.ship,function(e,r) {
                        if(!e) {
                            ret = window.cssgame.viewShipVarsResult(r);
                            window.energyStock = ret.energyStock;
                            window.grapheneStock = ret.grapheneStock;
                            window.metalsStock = ret.metalStock;
                            if (window.resourceBlock != 0 && ret.countdownToUpgradeResources == 0)
                                location.reload();
                            window.resourceBlock = ret.countdownToUpgradeResources;
                            window.damage = ret.damage;
                            setResourcesStock();
                            checkResourceUpgrade();
                            setCountdown();
                            setDamage()
                        }
                    });
                }, 5000);

                /*
                 * Check Events
                 */ 
                setInterval(function() {
                    backend.events.count(game,ship,function(e,r) {
                        if (!e) {
                            window.eventsCount = r.result.count;
                            setEventsCounter();
                        }
                    });
                },5000);

                /* tooltips */
                $('[data-toggle="tooltip"]').tooltip();
                
                $('[id=warehouse-load]').text(window.warehouseLoad);


       
                // slide panels
                function panelSlide(panelid, speed, direction, amount){
                    if(direction="left"){
                        $("#"+panelid).animate({"margin-left": amount}, speed)
                    }else{
                        $("#"+panelid).animate({"margin-right": amount}, speed)
                    }   
                }

                // initialize screen
                
                function init() {
                    $('#resources').show();
                    $('#stats').show();
                    panelSlide("resources", 1000, "left", "+=50%"); 
                    panelSlide("stats", 1000, "left", "-=50%");          
                }
                
                
                // call initializing routine
                init();

            }
            else {
                window.alert("Please change network");
            }
        });
    }
    else {
        window.alert("Install Metamask");
    }

    /*
        Primero que nada debemos inicializar las funciones del contrato
     */


    
    })
</script>
</html>